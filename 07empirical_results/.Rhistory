#this is to summarize results across simulation runs
#within each run, the median AFC correlation were obtained for each parameter combination & comparison(between and within supergroup)
#then those median values were used to plot the boxplot across simulation runs
summary_median_afc_cor <- afc_cor[, .(median_afc_cor = median(r)), by = .(gen, comparison, Run, Popsize, Num_sample, Num_target, Strength)]
plots <- list()
i <- 1
for (para_num_sample in c(400, 800, 1200, 2500)){
para_popsize <- 1250
dt_plot <- summary_median_afc_cor[
Popsize == para_popsize &
Num_sample == para_num_sample &
Num_target == para_num_target &
Strength == para_strength
]
plots[[i]] <- ggplot(dt_plot, aes(x=gen, y=median_afc_cor, fill=comparison))+
geom_boxplot()+
ylim(-0.1,1)+
#stat_compare_means(aes(group=comparison),method = "wilcox.test",label = "p.signif",hide.ns = TRUE)+
labs(title=paste0(para_num_target,"loci_s",para_strength, " (sc = ", para_strength/para_num_target, ")"),
x= "Generation", y = "AFC correlation")
i=i+1
}
}
#this is to summarize results across simulation runs
#within each run, the median AFC correlation were obtained for each parameter combination & comparison(between and within supergroup)
#then those median values were used to plot the boxplot across simulation runs
summary_median_afc_cor <- afc_cor[, .(median_afc_cor = median(r)), by = .(gen, comparison, Run, Popsize, Num_sample, Num_target, Strength)]
plots <- list()
i <- 1
for (para_num_sample in c(400, 800, 1200, 2500)){
para_popsize <- 1250
dt_plot <- summary_median_afc_cor[
Popsize == para_popsize &
Num_sample == para_num_sample &
Num_target == para_num_target &
Strength == para_strength
]
plots[[i]] <- ggplot(dt_plot, aes(x=gen, y=median_afc_cor, fill=comparison))+
geom_boxplot()+
ylim(-0.1,1)+
#stat_compare_means(aes(group=comparison),method = "wilcox.test",label = "p.signif",hide.ns = TRUE)+
labs(title=paste0(para_num_target,"loci_s",para_strength, " (sc = ", para_strength/para_num_target, ")"),
x= "Generation", y = "AFC correlation")
i=i+1
}
combine_plot <- ggarrange(
plotlist = plots,
ncol = 4, nrow = 1, common.legend = TRUE
)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage,"_median_AFC_cor"),
fig.lab.pos = "top.left", fig.lab.size = 20, fig.lab.face = "bold")
ggsave(filename = paste0(simulation,"/",linkage,"_median_AFC_cor_allSNPs.pdf"),plot = combine_plot, width = 20, height = 5)
rm(afc_cor)
rm(summary_median_afc_cor)
#this is to summarize results across simulation runs
#within each run, the median AFC correlation were obtained for each parameter combination & comparison(between and within supergroup)
#then those median values were used to plot the boxplot across simulation runs
summary_median_afc_cor <- afc_cor[, .(median_afc_cor = median(r)), by = .(gen, comparison, Run, Popsize, Num_sample, Num_target, Strength)]
#load AFC correlation
afc_cor<-NULL
para_popsize <- 1250
for (para_run in seq(1,10)){
for (para_num_sample in c(400,800,1200,2500)){
temp_f<-fread(paste0("../",workdir,
"/03afc_cor/results_allSNPs/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,"_",
para_num_target,"loci_s",para_strength,
"_cor.txt.gz"))
temp_f$Run <- para_run
temp_f$Popsize <- para_popsize
temp_f$Num_sample <- para_num_sample
temp_f$Num_target <- para_num_target
temp_f$Strength <- para_strength
afc_cor<-rbind(afc_cor,temp_f)
}
}
afc_cor$gen<-factor(afc_cor$gen)
#this is to summarize results across simulation runs
#within each run, the median AFC correlation were obtained for each parameter combination & comparison(between and within supergroup)
#then those median values were used to plot the boxplot across simulation runs
summary_median_afc_cor <- afc_cor[, .(median_afc_cor = median(r)), by = .(gen, comparison, Run, Popsize, Num_sample, Num_target, Strength)]
plots <- list()
i <- 1
for (para_num_sample in c(400, 800, 1200, 2500)){
para_popsize <- 1250
dt_plot <- summary_median_afc_cor[
Popsize == para_popsize &
Num_sample == para_num_sample &
Num_target == para_num_target &
Strength == para_strength
]
plots[[i]] <- ggplot(dt_plot, aes(x=gen, y=median_afc_cor, fill=comparison))+
geom_boxplot()+
ylim(-0.1,1)+
#stat_compare_means(aes(group=comparison),method = "wilcox.test",label = "p.signif",hide.ns = TRUE)+
labs(title=paste0("n",para_num_sample),
x= "Generation", y = "AFC correlation")
i=i+1
}
combine_plot <- ggarrange(
plotlist = plots,
ncol = 4, nrow = 1, common.legend = TRUE
)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage,"_median_AFC_cor_allSNPs"),
fig.lab.pos = "top.left", fig.lab.size = 20, fig.lab.face = "bold")
ggsave(filename = paste0(simulation,"/",linkage,"_median_AFC_cor_allSNPs.pdf"),plot = combine_plot, width = 15, height = 4)
ggsave(filename = paste0(simulation,"/",linkage,"_median_AFC_cor_allSNPs.pdf"),plot = combine_plot, width = 15, height = 5)
combine_plot <- ggarrange(
plotlist = plots,
ncol = 4, nrow = 1, common.legend = TRUE
)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage,"_median_AFC_cor_allSNPs"),
fig.lab.pos = "top.left", fig.lab.size = 15, fig.lab.face = "bold")
ggsave(filename = paste0(simulation,"/",linkage,"_median_AFC_cor_allSNPs.pdf"),plot = combine_plot, width = 15, height = 5)
#load AFC correlation
afc_cor_sig<-NULL
##selection
para_popsize <- 1250
for (para_run in seq(1,10)){
for (para_num_sample in c(400, 800, 1200, 2500)){
temp_f<-fread(paste0("../",workdir,
"/03afc_cor/results_PC1_sigSNPs/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,"_",
para_num_target,"loci_s",para_strength,
"_cor.txt.gz"))
temp_f$Run <- para_run
temp_f$Popsize <- para_popsize
temp_f$Num_sample <- para_num_sample
temp_f$Num_target <- para_num_target
temp_f$Strength <- para_strength
afc_cor_sig<-rbind(afc_cor_sig,temp_f)
}
}
afc_cor_sig$gen<-factor(afc_cor_sig$gen)
#load AFC correlation
afc_cor_sig<-NULL
##selection
para_popsize <- 1250
for (para_run in seq(1,10)){
for (para_num_sample in c(400, 800, 1200, 2500)){
temp_f<-fread(paste0("../",workdir,
"/03afc_cor/results_PC1_sigSNPs/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,"_",
para_num_target,"loci_s",para_strength,
"_cor.txt.gz"))
temp_f$Run <- para_run
temp_f$Popsize <- para_popsize
temp_f$Num_sample <- para_num_sample
temp_f$Num_target <- para_num_target
temp_f$Strength <- para_strength
afc_cor_sig<-rbind(afc_cor_sig,temp_f)
}
}
afc_cor_sig$gen<-factor(afc_cor_sig$gen)
#plot
##organize by run
plots <- list()
for (para_run in seq(1,10)){
plots <- list()
i <- 1
for (para_num_target in c(400,800,1200,2500)){
plots[[i]] <- afc_cor_plot(afc_cor_sig,
run = para_run,
popsize = para_popsize,
num_sample = para_num_sample,
num_target = para_num_target,
strength = para_strength,
ymin = -0.6, ymax = 1.0,
plot_title = paste0("n",para_num_sample))
i <- i + 1
}
combine_plot <- ggarrange(
plotlist = plots,
ncol = 4, nrow = 1, common.legend = TRUE
)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage,"_Run",para_run,"_AFC_cor_PC1_sigSNPs"),
fig.lab.pos = "top.left", fig.lab.size = 15, fig.lab.face = "bold")
ggsave(paste0(simulation,"/by_run/",linkage,"_Run",para_run,"_AFC_cor_PC1_sigSNPs.pdf"), plot=combine_plot, width = 15, height = 5)
}
##organize by selection regime
###selection
para_popsize <- 1250
for (para_num_sample in c(400, 800, 1200, 2500)){
plots <- list()
i <- 1
for (para_run in seq(1,10)){
plots[[i]] <- afc_cor_plot(afc_cor_sig,
run = para_run,
popsize = para_popsize,
num_sample = para_num_sample,
num_target = para_num_target,
strength = para_strength,
ymin = -0.6, ymax = 1.0,
plot_title = paste0("Run",para_run))
i <- i + 1
}
combine_plot <- ggarrange(
plotlist = plots,
ncol = 5, nrow = 2, common.legend = TRUE)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage, "_n", para_num_sample,"_AFC_cor_PC1_sigSNPs"),
fig.lab.pos = "top.left", fig.lab.size = 12, fig.lab.face = "bold")
ggsave(paste0(simulation,"/by_regime/",linkage,"_n",para_num_sample,"_AFC_cor_PC1_sigSNPs.pdf"), plot=combine_plot, width = 15, height = 7)
}
View(afc_cor_sig)
#load AFC correlation
afc_cor_sig<-NULL
##selection
para_popsize <- 1250
for (para_run in seq(1,10)){
for (para_num_sample in c(400, 800, 1200, 2500)){
temp_f<-fread(paste0("../",workdir,
"/03afc_cor/results_PC1_sigSNPs/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,"_",
para_num_target,"loci_s",para_strength,
"_cor.txt.gz"))
temp_f$Run <- para_run
temp_f$Popsize <- para_popsize
temp_f$Num_sample <- para_num_sample
temp_f$Num_target <- para_num_target
temp_f$Strength <- para_strength
afc_cor_sig<-rbind(afc_cor_sig,temp_f)
}
}
#load AFC correlation
afc_cor_sig<-NULL
##selection
para_popsize <- 1250
for (para_run in seq(1,10)){
for (para_num_sample in c(400, 800, 1200, 2500)){
temp_f<-fread(paste0("../",workdir,
"/03afc_cor/results_PC1_sigSNPs/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,"_",
para_num_target,"loci_s",para_strength,
"_cor.txt.gz"))
temp_f$Run <- para_run
temp_f$Popsize <- para_popsize
temp_f$Num_sample <- para_num_sample
temp_f$Num_target <- para_num_target
temp_f$Strength <- para_strength
afc_cor_sig<-rbind(afc_cor_sig,temp_f)
}
}
##parameters that are constant across this section
workdir <- "06slim_simulationC_LD_samplesize"
simulation <- "SimulationC"
linkage <- "LD"
para_num_target <- 100
para_strength <- 10
#load AFC correlation
afc_cor_sig<-NULL
##selection
para_popsize <- 1250
for (para_run in seq(1,10)){
for (para_num_sample in c(400, 800, 1200, 2500)){
temp_f<-fread(paste0("../",workdir,
"/03afc_cor/results_PC1_sigSNPs/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,"_",
para_num_target,"loci_s",para_strength,
"_cor.txt.gz"))
temp_f$Run <- para_run
temp_f$Popsize <- para_popsize
temp_f$Num_sample <- para_num_sample
temp_f$Num_target <- para_num_target
temp_f$Strength <- para_strength
afc_cor_sig<-rbind(afc_cor_sig,temp_f)
}
}
afc_cor_sig$gen<-factor(afc_cor_sig$gen)
#plot
##organize by run
plots <- list()
for (para_run in seq(1,10)){
plots <- list()
i <- 1
for (para_num_sample in c(400,800,1200,2500)){
plots[[i]] <- afc_cor_plot(afc_cor_sig,
run = para_run,
popsize = para_popsize,
num_sample = para_num_sample,
num_target = para_num_target,
strength = para_strength,
ymin = -0.6, ymax = 1.0,
plot_title = paste0("n",para_num_sample))
i <- i + 1
}
combine_plot <- ggarrange(
plotlist = plots,
ncol = 4, nrow = 1, common.legend = TRUE
)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage,"_Run",para_run,"_AFC_cor_PC1_sigSNPs"),
fig.lab.pos = "top.left", fig.lab.size = 15, fig.lab.face = "bold")
ggsave(paste0(simulation,"/by_run/",linkage,"_Run",para_run,"_AFC_cor_PC1_sigSNPs.pdf"), plot=combine_plot, width = 15, height = 5)
}
##organize by selection regime
###selection
para_popsize <- 1250
for (para_num_sample in c(400, 800, 1200, 2500)){
plots <- list()
i <- 1
for (para_run in seq(1,10)){
plots[[i]] <- afc_cor_plot(afc_cor_sig,
run = para_run,
popsize = para_popsize,
num_sample = para_num_sample,
num_target = para_num_target,
strength = para_strength,
ymin = -0.6, ymax = 1.0,
plot_title = paste0("Run",para_run))
i <- i + 1
}
combine_plot <- ggarrange(
plotlist = plots,
ncol = 5, nrow = 2, common.legend = TRUE)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage, "_n", para_num_sample,"_AFC_cor_PC1_sigSNPs"),
fig.lab.pos = "top.left", fig.lab.size = 12, fig.lab.face = "bold")
ggsave(paste0(simulation,"/by_regime/",linkage,"_n",para_num_sample,"_AFC_cor_PC1_sigSNPs.pdf"), plot=combine_plot, width = 15, height = 7)
}
#this is to summarize results across simulation runs
#within each run, the median AFC correlation were obtained for each parameter combination & comparison(between and within supergroup)
#then those median values were used to plot the boxplot across simulation runs
summary_median_afc_cor_sig <- afc_cor_sig[, .(median_afc_cor = median(r)), by = .(gen, comparison, Run, Popsize, Num_sample, Num_target, Strength)]
#this is to summarize results across simulation runs
#within each run, the median AFC correlation were obtained for each parameter combination & comparison(between and within supergroup)
#then those median values were used to plot the boxplot across simulation runs
summary_median_afc_cor_sig <- afc_cor_sig[, .(median_afc_cor = median(r)), by = .(gen, comparison, Run, Popsize, Num_sample, Num_target, Strength)]
plots <- list()
i <- 1
for (para_num_sample in c(400,800,1200,2500)){
para_popsize <- 1250
dt_plot <- summary_median_afc_cor_sig[
Popsize == para_popsize &
Num_sample == para_num_sample &
Num_target == para_num_target &
Strength == para_strength
]
plots[[i]] <- ggplot(dt_plot, aes(x=gen, y=median_afc_cor, fill=comparison))+
geom_boxplot()+
ylim(-0.6,1)+
#stat_compare_means(aes(group=comparison),method = "wilcox.test",label = "p.signif",hide.ns = TRUE)+
labs(title=paste0(para_num_target,"loci_s",para_strength, " (sc = ", para_strength/para_num_target, ")"),
x = "Generation", y = "AFC correlation")
i=i+1
}
combine_plot <- ggarrange(
plotlist = plots,
ncol = 4, nrow = 1, common.legend = TRUE
)
combine_plot<-annotate_figure(
combine_plot,
fig.lab = paste0(simulation,"_",linkage,"_median_AFC_cor_PC1_sigSNPs"),
fig.lab.pos = "top.left", fig.lab.size = 15, fig.lab.face = "bold")
ggsave(filename = paste0(simulation,"/",linkage,"_median_AFC_cor_PC1_sigSNPs.pdf"),plot = combine_plot, width = 15, height = 5)
rm(afc_cor_sig)
rm(summary_median_afc_cor_sig)
dt_ne <- data.table()
#load data
##selection
for (para_run in seq(1,10)){
for (para_popsize in c(1250)){
for (para_num_sample in c(400,800,1200,2500)){
f_name <- paste0("../",workdir, "/04estimate_Ne/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,
"_",para_num_target,"loci_s",para_strength,
".ne")
temp_ne <- fread(f_name)
temp_ne[, c("run", "popsize", "num_sample", "num_target", "strength") :=
lapply(
tstrsplit(treatment, split = "_", fill = NA),
factor)]
dt_ne <- rbind(dt_ne, temp_ne)
}
}
}
}
dt_ne <- data.table()
#load data
##selection
for (para_run in seq(1,10)){
for (para_popsize in c(1250)){
for (para_num_sample in c(400,800,1200,2500)){
f_name <- paste0("../",workdir, "/04estimate_Ne/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,
"_",para_num_target,"loci_s",para_strength,
".ne")
temp_ne <- fread(f_name)
temp_ne[, c("run", "popsize", "num_sample", "num_target", "strength") :=
lapply(
tstrsplit(treatment, split = "_", fill = NA),
factor)]
dt_ne <- rbind(dt_ne, temp_ne)
}
}
}
dt_ne[, num_target := factor(num_target, levels = c("Drift300","Drift1250",
"10loci", "100loci", "1000loci", "5000loci", "10000loci", "20000loci"))]
#plot
plots <- list()
i <- 1
for (para_run in seq(1,10)){
plots[[i]] <- ggplot(subset(dt_ne, run==paste0("Run", para_run)), aes(x=num_target, y = Ne, fill = strength))+
geom_boxplot()+
geom_hline(yintercept = 261, linetype = "dashed")+
scale_fill_manual(values = c("white","#D4EEFC","#FAECAF","#ECC4B5"))+
facet_grid(~strength, scale = "free_x", space = "free_x")+
labs(x="Number of Selection Targets", y="Effective Population Size (Ne)", title = paste0("Run",para_run))+
theme(legend.position = "none",
axis.text.x = element_text(angle = -60, vjust = 0.5, hjust = 0))
i <- i + 1
}
merge_p <- ggarrange(plotlist = plots,
nrow=2, ncol = 5)
merge_p<-annotate_figure(
merge_p,
top = text_grob(
paste0(simulation,"_",linkage,"_Ne"),
color = "black", face = "bold", size = 20,
x = 0, hjust = 0
)
)
#fig.lab = paste0(simulation,"_",linkage,"_Ne"),
#fig.lab.pos = "top.left", fig.lab.size = 20, fig.lab.face = "bold")
ggsave(filename = paste0(simulation,"/",linkage,"_Ne.pdf"), plot = merge_p, width = 30, height = 13)
rm(dt_ne)
dt_ne <- data.table()
#load data
##selection
for (para_run in seq(1,10)){
for (para_popsize in c(1250)){
for (para_num_sample in c(400,800,1200,2500)){
f_name <- paste0("../",workdir, "/04estimate_Ne/Run",para_run,
"_popsize",para_popsize,
"_n",para_num_sample,
"_",para_num_target,"loci_s",para_strength,
".ne")
temp_ne <- fread(f_name)
temp_ne[, c("run", "popsize", "num_sample", "num_target", "strength") :=
lapply(
tstrsplit(treatment, split = "_", fill = NA),
factor)]
dt_ne <- rbind(dt_ne, temp_ne)
}
}
}
dt_ne[, num_target := factor(num_target, levels = c("Drift300","Drift1250",
"10loci", "100loci", "1000loci", "5000loci", "10000loci", "20000loci"))]
#plot
plots <- list()
i <- 1
for (para_run in seq(1,10)){
plots[[i]] <- ggplot(subset(dt_ne, run==paste0("Run", para_run)), aes(x=num_target, y = Ne, fill = strength))+
geom_boxplot()+
geom_hline(yintercept = 261, linetype = "dashed")+
scale_fill_manual(values = c("#D4EEFC"))+
facet_grid(~strength, scale = "free_x", space = "free_x")+
labs(x="Number of Selection Targets", y="Effective Population Size (Ne)", title = paste0("Run",para_run))+
theme(legend.position = "none",
axis.text.x = element_text(angle = -60, vjust = 0.5, hjust = 0))
i <- i + 1
}
merge_p <- ggarrange(plotlist = plots,
nrow=2, ncol = 5)
merge_p<-annotate_figure(
merge_p,
top = text_grob(
paste0(simulation,"_",linkage,"_Ne"),
color = "black", face = "bold", size = 20,
x = 0, hjust = 0
)
)
#fig.lab = paste0(simulation,"_",linkage,"_Ne"),
#fig.lab.pos = "top.left", fig.lab.size = 20, fig.lab.face = "bold")
ggsave(filename = paste0(simulation,"/",linkage,"_Ne.pdf"), plot = merge_p, width = 30, height = 13)
rm(dt_ne)
library(data.table)
library(poolSeq)
#load sample information
#1. get sample information----
all_samples <- fread("00data/header", header = FALSE)$V1
setwd("~/vetlinux04/04Dsim_SA_flucVScons/06slim_2025/01simulation_10runs_chr2L/07empirical_results/")
library(data.table)
library(poolSeq)
#load sample information
#1. get sample information----
all_samples <- fread("00data/header", header = FALSE)$V1
#2. load data----
para <- "biallelic.max15.min85.SA.hfluc_hcons.F0-F80.flt"
print(para)
file_af <- paste0('./00data/',para,".af.txt.gz")
file_cov <- paste0('./00data/',para,".cov.txt.gz")
dt_af <- fread(file_af, header = F, nrow=10000)
